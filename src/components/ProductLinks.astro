---
const { keyword, imageUrl } = Astro.props;

const amazonTag = import.meta.env.AMAZON_ASSOCIATE_TAG || 'blitz011-22';
const rakutenId = import.meta.env.RAKUTEN_AFFILIATE_ID || '50b8fe39.c32fe89a.50b8fe3a.60c7ccae';

const currentPath = Astro.url.pathname;
let region = 'JP';
if (currentPath.includes('/en-us/')) region = 'US';
if (currentPath.includes('/en-in/') || currentPath.includes('/hi-in/')) region = 'IN';

let amazonUrl = `https://www.amazon.co.jp/s?k=${encodeURIComponent(keyword)}&tag=${amazonTag}`;
let buttonText = "ÂÄ§ÊÆµ„ÇíÁ¢∫Ë™ç";

if (region === 'US') {
  amazonUrl = `https://www.amazon.com/s?k=${encodeURIComponent(keyword)}`; 
  buttonText = "Check Price";
} else if (region === 'IN') {
  amazonUrl = `https://www.amazon.in/s?k=${encodeURIComponent(keyword)}`;
  buttonText = "Check Price";
}

const rakutenBase = `https://search.rakuten.co.jp/search/mall/${encodeURIComponent(keyword)}`;
const rakutenUrl = `https://hb.afl.rakuten.co.jp/hgc/${rakutenId}/?pc=${encodeURIComponent(rakutenBase)}`;

const showRakuten = region === 'JP';
---

<div class="product-links">
  <div class="product-header">
    {imageUrl && (
      <div class="product-thumb">
        <img src={imageUrl} alt={keyword} />
      </div>
    )}
    <div class="product-info">
      <div class="product-label">
        <span class="label-icon">üõçÔ∏è</span>
        <span class="label-text">{buttonText}:</span>
      </div>
      <div class="product-name">{keyword}</div>
    </div>
  </div>
  
  <div class:list={["buttons", { "single-col": !showRakuten }]}>
    <a href={amazonUrl} target="_blank" rel="noopener noreferrer" class="btn amazon">
      <img src="/images/amazon-logo.png" alt="Amazon" class="logo-img amazon-img" />
    </a>
    {showRakuten && (
      <a href={rakutenUrl} target="_blank" rel="noopener noreferrer" class="btn rakuten">
        <img src="/images/rakuten-logo.png" alt="Rakuten" class="logo-img rakuten-img" />
      </a>
    )}
  </div>
</div>

